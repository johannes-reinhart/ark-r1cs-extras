use crate::poseidon_parameters::{convert_str_vec_to_fields, PoseidonConfigError};
use ark_bn183::Fr;
use ark_crypto_primitives::sponge::poseidon::PoseidonConfig;
use ark_ff::PrimeField;
#[cfg(not(feature = "std"))]
use ark_std::vec;

pub fn poseidon_parameters<F: PrimeField>() -> Result<PoseidonConfig<F>, PoseidonConfigError> {
    let rate = 4;
    let capacity = 1;
    let full_rounds = 8;
    let partial_rounds = 39;
    let alpha = 5;
    let t = rate + capacity;
    let ark = vec![
        "2813871674669608525321557170840323410098642029039834893",
        "5364819497343631950037753125498720056792089965649350919",
        "3834860519707092483137356858027036489271749038269268167",
        "1963263870003776459334640335957418144701168155996470922",
        "5779414735820725695200264055747486547015758961310163917",
        "5677698492061905017743656916089382426055251876151394824",
        "5351737282870480310590566698428143071854590410252089273",
        "1450008552985582948555146422962429514002813188930394842",
        "4912763892277707408849123179828321969464108074065423124",
        "5184384644827995323180422533076649447256048130714396722",
        "1624136092838456382237253037833082155008796164794893965",
        "3624433632898404964895934604753300849504976280640148402",
        "740385311973277112111620603448670278417845277588342047",
        "2070967503630350868366028062821345134426831951107599873",
        "4235714428700616941325473559578612910472890838795098529",
        "1527440645491880180099734552346611666785585362476578810",
        "4157356232706216416326534064313941595891903242228373599",
        "749862711248575414744610157190533820857066151301315577",
        "1795411332951032200669795927402004067591965502745368001",
        "5522224778165301515136045774758396933928060230403807780",
        "940063127077956160099538488808674546583583124463534996",
        "1074978670141141636373938037948628567408857632684632262",
        "4992436776950360469159147107005933502683198046629687205",
        "6133443676828673180166367885332828817289131053756672555",
        "977953584118547339999469457201519647235896153303242249",
        "521695780875737123851811098098098593161777577255684331",
        "2884383257380112200385059464002716399827826587484957325",
        "824169646583050506085259016353071503712999090770316829",
        "5957956289096527922801071240085874800890637847143595140",
        "984596331050257288526259103574279394053422040654078211",
        "731444991318898617894480619395085782443736412478022083",
        "1022124859350699440671159065974934162418356838601969989",
        "469310122463690949123617705017869489810399695204233812",
        "6322897901466438235920461612775078038626892315780164686",
        "870667595146792515994596318034144580418379433076334654",
        "6137494746382121048753121606181531285280104563755017582",
        "3680774475245097058041681678481218726992583155594845991",
        "5865784856989603147676554935645076870481315965116734641",
        "125578127963306218718084540960990392548057700400993991",
        "3495444889806517328015243590231997614007227914272425749",
        "5054785982345783781610771373911577620909876643420515740",
        "4522830256102862547104251148986527464754601398767090178",
        "1635274017020502218070490970693828730519246857848717693",
        "563889216606627814235897779738956583594250888508770406",
        "3540042776230755325233865816266182371395630553191578239",
        "1424723781476172028247286793556425074994755617837480402",
        "3479549578707335477982271595657273202313677426285829041",
        "4993901454675721539849019653412342144543133586780054973",
        "5408319140918725593724070645262953615871153506559911723",
        "443173450165914791676351470658091639969380644241063642",
        "5342550389414776385341916833807444432269595155505472193",
        "5509777882684284870649732481712437523965492153409555871",
        "4629583161783093288695833074197744603107735804965681582",
        "5003860592419222519002974914398512362393852183131576641",
        "3158151474181888853836173600940648477377238681152663498",
        "87759573323128095679497779241635949124162367679969847",
        "6655647266708392758692410057818763872246566001054054980",
        "6780234617460038283829009301727535900187323149764554187",
        "6619473701306157468725659398670567995940125874421873121",
        "4914000520810432265723996337487026051121596275231022554",
        "3019880634607160958508283224263450258559870768515256920",
        "567491402045225127122641568574822133066113778644205461",
        "543566984191580149958992839777388064185371181966340976",
        "4550302047217860767161492339502314951672094659328275548",
        "3996845055210879879168989845488510870476134673744733836",
        "336150144854952517843640485008979139204883913449197841",
        "4359442774854439428549778364891089625230260832996397605",
        "4930037178871418808110730054938814317745861535418565384",
        "817525757815017271107218304126449590323089581574520932",
        "4454960169926565047280177005305294539346235597158052410",
        "5403075119969322860018239944283342663710500014656522470",
        "6181321810365019505253017609243923067550453444236394846",
        "325060963059219838351842147047883850442304820534374593",
        "66999905148820702715821335615653927309033592868881844",
        "3814743829370960053211878916753483943371669186097478863",
        "6435995229003800579069457084621298843762121923634896424",
        "2887806359627070375640211917397482610070267938803471770",
        "4174788542122726134455172015307279346634414134320072026",
        "5476672808411262275420631261381332124553232606281374750",
        "1059359994654415007315372476575895052845841583827686159",
        "5379303526680305407803605046799229239468633993471207948",
        "5286020673703333616871764129230091020630120361818604818",
        "4593441645649677907073699757208054013615039730157181332",
        "1497517999723693334120035531127940870642911744117904664",
        "3904494815523542062829089471492034983286543930880964509",
        "1053922740899978752665394589546616712986534216201732328",
        "1310485409924123891354622903223334231365502956401543732",
        "6572668214166351908831428624939012487659778841864657908",
        "6551014106847416138743743907791973343485508535265752757",
        "264168299995439565225921763825068280259575798318524572",
        "4498760212153133899787116411028300265331836228775851122",
        "140721370682093141067930574334592879715003282822889096",
        "4596811177878319056931207159964129297326225963507081078",
        "4109609041661017138459558266676750891534780795019080255",
        "806977057979172610791002734329395021149692604355220670",
        "3717141000834334645090486541774127750471370618759097403",
        "57496497087833455676982531348109805227494161054913805",
        "3587570210560910990169929683155097688687995198980087857",
        "3998872554861178376674690860351093500446050132172405197",
        "1651101274471451081624510996103613395788141800928263978",
        "368045412655042296477660877428686131588213915218385462",
        "1343620522456259013340725125342483922071965046835800356",
        "5248631968071790522544050170429433292430408549165352038",
        "5435705297310258895795005749599359750902514966242195913",
        "6762115366800303500392850440245625384334354556794518541",
        "2766897448442450314648036083460474249612015825796592184",
        "4588368558941434963223991786462734139570259551330490875",
        "5019462896157973890119961958365719028669301789891916860",
        "979551227650322096396974257124365706496144714659872549",
        "4001689331074565407276093427161571699601768183836166068",
        "5883933428712206989939246548258038601401544143105678397",
        "5513010863190847118604607064584627737729246233546343373",
        "6220223537112763935462289922784711858933314975096204372",
        "286043793011185335477140415866001023706979096118294552",
        "4183382179541922792652091575129820525767434904644826826",
        "3879322071063625071004497627635712423371207213399795202",
        "1791735841195193621685204076204511551057587434967131409",
        "4565610702880790823122852928182373412076274874074932467",
        "6660910636861441984533517714214529118178810794010625685",
        "5495227592662983611650477217537187171597637576308404532",
        "4200481154716426396451955055085423956943858478466644961",
        "4298971791153245176437615782743812126251366719946225360",
        "198618666439715658088639795413130578696164624872098314",
        "6383684760446589311898489352983838033767404565785726030",
        "151797462792099362654640607106669818010021456888340077",
        "2211084643311407246214241172553049729397747307687155137",
        "2667254782449026654857997364415776896253687761842528889",
        "3043525519084666107663156295283137191174649331850931507",
        "2554513290997570123207640973252334249721117906318339931",
        "6533119308412558610827060009189713054274494107031622024",
        "146577452167748742122754311851669520029561907205907869",
        "2441676046690471783307804287055252447107646012270861835",
        "774100200629138493464428943448975561747075098460112001",
        "4209623387199805861842369286990207507841031609241567992",
        "3445878414859421631021488410491082810922011076543163709",
        "590065953850566296075527557888965247663771881108257131",
        "2197192821329039710425546309168367917348802327060699469",
        "310068003357080001787871279009519295148090002222500069",
        "4189358120392228546252611531212494740465392514494160788",
        "5308232338509054143500549913811103074822370909573955288",
        "5828963113603641982395278373651830177676720263365040864",
        "1697567958065416245655866683739375232383761244638976343",
        "5888187836670706867548912030567112678657457846806451173",
        "205965166077510882869295141284363339139130344597405252",
        "6803614110921830894202798963162496580320406565613752636",
        "2452021830585735280871126404095094860645724430083910945",
        "3508343715953582285877274867775756309432661764077131129",
        "3110905818516557057407011413764343641334595372333119554",
        "1104151540607194438799168685073624694117827984788085302",
        "1170291788180146746976828166150360611131969173357634509",
        "5548276145482514268822129746534069399074223434143629272",
        "2008780528667488182956464674713751612074370439251490967",
        "6282124963008535244779425913108934582122537809535197766",
        "5547184206163633323908734230131791747901261302627946730",
        "494898198582030356755468826646665274867552706301769531",
        "6112593455243664776616069503103348654798193273735001288",
        "5872940955148554684981120996432751260715670410954082578",
        "1433445400920833767487699806786110549590683693455292130",
        "4999627655737556655471598594425150065433272182103482134",
        "3658923293022753484753753904156753886610201710034698990",
        "234121351530903920929392077235428827375501990437858261",
        "5247990190566826840902820968467255844982042234019971943",
        "3078853976356137540041455650313693421173862939983838863",
        "2153762370811347396362502860074947017417126627124441632",
        "5093751946301138260888832356369270289168240069234405585",
        "5246587224273683363103298651595707236785705743135926976",
        "4820466197062443291005465336623378373272415228929724535",
        "4881321195361882992037373542723527960903300440742119508",
        "6460022747188771913907408120526270350391193267280093357",
        "3670770526730443170472327726287628724150860568434512191",
        "783420026882774830467234312948277443126700421722894115",
        "5463290837477718094655667242573431570197693806671792395",
        "6154270099868392997465089998861128615839871942261506757",
        "2136281056583491445065142018926247444905809406385958645",
        "5338887712659697694978288002602853733563705279026194740",
        "5618611479160312636475881092736869696817826215133814686",
        "6440412387230316981065128140240664709592256668422793603",
        "4516523342445161394590142401715476816140873163120938749",
        "5366886378562587876857451015756940567400818103696595455",
        "6041629796113895509554244924727257378396408651046913968",
        "3199860321261337851909127616432855356062376302271662820",
        "5227661575849152998147674356175257285445942726490734917",
        "1460737630145439833563275177867274614012695659883250408",
        "6802725390295225675781003104484330383736064472378127676",
        "628369806105575332642688099459102056984702696788473490",
        "6154771754692705472484503552928714671486591312304457761",
        "3576672498118862989923442797169172721459066233687306051",
        "990439422530198334452916174731233867452546653141637992",
        "2302286388521593053428739122996885321661472527867650210",
        "6425050604857178686293733560545215910938582063586802046",
        "3249399893074909955113595753141565029924591692686660324",
        "6461326119161010803726915581687653464565493546308906386",
        "4981829010253438297835917291389537638837531063004748960",
        "2372681674555520113716697579175706672137226567958149566",
        "2763793250730646796133629482738374712833374652716600743",
        "4531405159981689082659589746994200097830262394795709302",
        "4923967589582093170166163293848036839000831730355636665",
        "3143478410771020293122786691163979845655390264584498356",
        "6332366205632859162418473855053807809671730267332437673",
        "4057229592494185024045341543670318416993095789517125768",
        "6344508727226438339498611494535188078657725713641002924",
        "5983366074632715748145879797151807298972704124434163376",
        "2608173201800154337487509354345441812779184854013320679",
        "2947564133029806468178822967058911658670554973413301344",
        "2422789630403547450394112838084239325234330214082594731",
        "4927768275977594975698216327972268829879886725556443534",
        "901266043127038587002585520063167255999679036430278912",
        "4675072380177567795659342393267807668840549308305195170",
        "775103037839427033534845509395474147011503741674314432",
        "2810703328689416360586657089365827431996662503108356399",
        "3743978880922890389996094569153408339713304250764366786",
        "3243358894323494368175435432371895007121324438855433183",
        "2899434220123096471650023860638152393679170549235440100",
        "3204825536074930291111289119266818709888006045176846946",
        "1032003124944821390478060527743582213496141364105590871",
        "5933136254105016371523223078768061275707430155463220789",
        "1943801663590516329713702954889601141328870824736908062",
        "2262292727928722638254559613756685120886441665996845652",
        "2680944656079742876265386113871108520073075631784745838",
        "4393329593909630665641545392385472915008125434954124434",
        "5266214177349060291897612372802553072684529325020253099",
        "5478159210449906606744150704737433368795824779579244893",
        "6684199742946762743498428083329269238408753081137654790",
        "816785733093553012102937967188379461570011684574438091",
        "2630384911644518822342398529652883899585322919768553433",
        "1220566786600856891020302777909438914540289906718153585",
        "3983673251280688370379281239845352984631722796801071551",
        "2529290664823502987316489313499129750705249912505730420",
        "1372396492121703855016140068022299524808456640847631910",
        "1803891885486800857793498909768977272968844978898773436",
        "1936401596656570874546991559213605748060685899175984012",
        "1367337739611698106481879370754337229374469943587701939",
        "5266373682051728535271238004585707511143282738176033973",
        "1974926916692086733051742464400637490003195817633143343",
        "6071955603016647444964978539003784931193860682167130625",
    ];
    let mds = vec![
        "2004668984873659750636104686407774412036516838665179073",
        "170471726342127305100883768607653299907768421711538037",
        "2649347383186806740677277306752236502845229308064191781",
        "5594414568662200003131987136069731409622108352873172225",
        "5470750546953380685580884477589861078817215773674273075",
        "3477155565383354163489274758641060194629464835015415568",
        "5880250424950102618563977428853164113389015117564623559",
        "5366309229284405185677628336391618885463039803600186711",
        "469367078523872082529628169495296255685938884168709342",
        "5622303163557147386963762837358541681457291582097165064",
        "4326142419946655747944602277170394123762125996080923406",
        "990612848961225539815876771917569197667356819555300577",
        "342247659812839538819705732226969054110453626440312329",
        "3348100057158174951194971389197924561928347909334470796",
        "654654859879258400939694451228695085423257001008203250",
        "6002675058264368213996751597400551091785107618904023843",
        "3862362812615940142347924269766299541681367664614759876",
        "3898964247069505500861072165367876459550934432512777962",
        "4035347765815886186474339358055471415974521223417514334",
        "747595368658145629978763677013778680962130426897562222",
        "3523512476419513596624538211787922062897073557149050722",
        "3987267661485832864260891967710324576927501187709949188",
        "2755894180067256997420905803728606514200712339286295016",
        "2947566274830596654700585276814765240572123188222475867",
        "5691104996586928182329728857132052183046982130023121463",
    ];

    assert_eq!(ark.len(), (full_rounds + partial_rounds) * t);
    assert_eq!(mds.len(), t * t);

    let ark = convert_str_vec_to_fields::<F>(t, &ark)
        .map_err(|_| PoseidonConfigError::ConversionError)?;
    let mds = convert_str_vec_to_fields::<F>(t, &mds)
        .map_err(|_| PoseidonConfigError::ConversionError)?;

    Ok(PoseidonConfig {
        full_rounds,
        partial_rounds,
        alpha,
        ark,
        mds,
        rate,
        capacity,
    })
}

pub fn poseidon_parameters_bn183() -> PoseidonConfig<Fr> {
    poseidon_parameters::<Fr>().unwrap_or_else(|_| panic!("could not convert parameters"))
}

#[cfg(test)]
mod tests {
    use super::*;
    use crate::poseidon_parameters::tests::test_poseidon_against_vectors;
    use ark_bn183::Fr;
    use std::str::FromStr;

    #[test]
    fn test_poseidon() {
        let params = poseidon_parameters_bn183();

        let input0 = vec![Fr::from(0)];
        let digest0 =
            Fr::from_str("2232912422227738220057631181368737363179198100227112849").unwrap();

        let input1 = vec![Fr::from(1), Fr::from(2), Fr::from(42)];
        let digest1 =
            Fr::from_str("6361341321676331058100225115819603366203569200641309086").unwrap();

        let input2 = vec![
            Fr::from(2347272),
            Fr::from(3512325),
            Fr::from(950157783),
            Fr::from(35),
            Fr::from(26357),
            Fr::from(354738949),
            Fr::from(30086),
            Fr::from(246849),
            Fr::from(56943),
        ];
        let digest2 =
            Fr::from_str("2089789547731550426988018506733488890116856213934534209").unwrap();

        let input3: Vec<_> = (0..100).into_iter().map(|i| Fr::from(i)).collect();
        let digest3 =
            Fr::from_str("5267124007638145956180778987015779906174512096879578084").unwrap();

        test_poseidon_against_vectors(
            &params,
            &vec![
                input0.as_slice(),
                input1.as_slice(),
                input2.as_slice(),
                input3.as_slice(),
            ],
            &vec![digest0, digest1, digest2, digest3],
        )
    }
}

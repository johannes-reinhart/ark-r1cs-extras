use crate::poseidon_parameters::{convert_str_vec_to_fields, PoseidonConfigError};
use ark_bn124::Fr;
use ark_crypto_primitives::sponge::poseidon::PoseidonConfig;
use ark_ff::PrimeField;
#[cfg(not(feature = "std"))]
use ark_std::vec;

pub fn poseidon_parameters<F: PrimeField>() -> Result<PoseidonConfig<F>, PoseidonConfigError> {
    let rate = 4;
    let capacity = 1;
    let full_rounds = 8;
    let partial_rounds = 25;
    let alpha = 5;
    let t = rate + capacity;
    let ark = vec![
        "12897761084857435273579354839693474248",
        "7742874145263933009661434840224121515",
        "16894264841312269258182297008566991327",
        "12050425369038124205470663340074185051",
        "16656569329359945553478191243533106262",
        "15265194084391196771219091262294399590",
        "11034910076462213318993904561683454916",
        "13677435121296819738993369011618454220",
        "7609712287747023220735864078578817802",
        "11602557442480582222787131702584828580",
        "9372859541159187460847286086498288088",
        "12001745098845508509069182447261966538",
        "8060020796067513396178140542690437717",
        "10430109346808482444055054464829163066",
        "8909952553855781125293920359315878542",
        "7119459154070071728096735880241510175",
        "10448688732917859660337535631339836489",
        "10673316050166789642380168905949245854",
        "4752774335874467146749442498036223378",
        "1981470141386384443098058873826987981",
        "2522985277855906354337768233221386683",
        "9522184798409801904339277592429326883",
        "9790976356945848361789833817519287797",
        "14443908819320388961043909298042276849",
        "3496827859686369072611620505584803784",
        "15403985977256840980259990599433057032",
        "14685094998870097977221872039388268578",
        "2076704679797799973257059353665176976",
        "16367846793856686552232004106317388183",
        "10081572038338276149632760181372373331",
        "6016608308656039669053694947758253546",
        "274728028709490441925780759083840322",
        "4883649828495922480239808697310935955",
        "8894579609931408762638451494791656645",
        "14701738160966943840966968233252582037",
        "14805929927380425130212257904369949884",
        "12296007932404538090950558606547966700",
        "11972326291527173284309145689501362157",
        "7509627269683424052110285223658016832",
        "7014163002734853490668796299357921376",
        "5767112314110637402685637354681840747",
        "9658164209663646625925183672135179987",
        "5403185008399308425975414140446932243",
        "5815636553832274047077978610758435208",
        "8699972930345002343860185645427629479",
        "13502824815359816051740230362311143634",
        "3366221884257466985782267787587791255",
        "15735889327702291890934784789664397237",
        "8281616190323223428094487784448712342",
        "4071298049741156495846633904779236924",
        "2374632667190904705006949697008858040",
        "800454154659521861087770605633003206",
        "16988452739206469492489340239428744543",
        "13705658064778525958570870709110652934",
        "4001754242134086291786358666572427992",
        "12573634779633604126569631545426191147",
        "11839287650342412772585458586526922643",
        "11123192004327428869151223561386065797",
        "7605771466936440705182386869045807048",
        "10016973154823232399496782272884251372",
        "11563476705510916488481705961934673625",
        "16614828032507997013469293075544541190",
        "12728776797825096034154233827377078666",
        "11678052788838295775245198109867121966",
        "4132546742179685099260866815552436934",
        "2083500531621300823063170085407504016",
        "6691809050359627538982762318936125393",
        "100995444408309081613214481390843985",
        "1570003183758534790132230434986022188",
        "15693926553074265272450172103803527723",
        "14485594130352108234028967394160153114",
        "11874606402688589711049458458444344209",
        "11485089643655205516235371062251107191",
        "11879073015454389155273032078165754902",
        "6192404008575954772022544228657583346",
        "1606068946924720319131313557947832840",
        "10012647484410706070808810184145320413",
        "8923436129490057011529701609854997460",
        "8171220206953076827285649473671077060",
        "138863365471614173829517257371894388",
        "12740640834894994142632640575207445000",
        "9807403814022425688475536066863900696",
        "3884673008986272460983664530370194588",
        "5958002450921067687638547791400776858",
        "6471348702066725997033820043005957889",
        "8935660476569412489149071777883454854",
        "2459389476288645977473042521646451416",
        "5619357905453202691843086630850012126",
        "15712776755410333894667208683083991332",
        "4432922680423603198650371088941647593",
        "15927362033925746666443499082822777006",
        "4471079801039935003110852578715437469",
        "827193941012338292739953519009499634",
        "3563105410647014818260410123722921269",
        "1414952478637294009056604430408067152",
        "9693027515415845407250741556948867958",
        "13847483402808064330067486589496239921",
        "4361144904186782751639992043068183263",
        "1521646922624136943027364219160498688",
        "7055812791184052851130210494618248385",
        "14075048589221369737247319726036146412",
        "9476513880224089670565219754837304835",
        "5628763765184201795522797010814243157",
        "6099335197697042766689933924356208125",
        "11076953655723779099656667330945394002",
        "7747482155488362173013685832233581956",
        "7099097309581021621993876019641147593",
        "5184833257584112149505854639061878705",
        "6265856524244355456575705192565668209",
        "8974925561753961075897313464226925926",
        "7332397009740368295857702728701718209",
        "8937376311883300152661197711570367341",
        "16861814696033522672896966014221365920",
        "80778585358228153482831401558304644",
        "7254304879556621709549420427662622623",
        "913122837290456574870898575614925229",
        "3152578133129024057354894848077860682",
        "3377921802851565635972181402789196668",
        "10796683847207846979636739264632419646",
        "6734177137731866437183126092466883828",
        "15377733161159869762432353911262434412",
        "12535748875170106794794513161917925754",
        "5927241547785153549394044504760277551",
        "9866290583530986698799112598450034586",
        "12874490392782780790638283378869923720",
        "879899339876263542793714072152499137",
        "9571178848432093010350655772641434593",
        "77524271165078503986298121521679088",
        "16326039667977589790079811660647480997",
        "1550170863985681801178971492921123406",
        "15564075913460486533081661279640123544",
        "12071904960782145697418021279398183844",
        "11701016037625543570274344910407446190",
        "9582265579693626791962272022944745957",
        "8735719089539734130485110213614474937",
        "6611241871106566787389971831264488410",
        "16225299353866495332831330589386705576",
        "13890199448058870015612133968240557409",
        "12090126427715073707894061753615001066",
        "11186838979608724389748082114402474533",
        "9038253165297089163371808566807111756",
        "6787048153050125967139004554844009013",
        "10214216481818964092139713614889721096",
        "14214317348373896789186493441624967579",
        "10370303138295915125725557254497284054",
        "15066902868425528136687155086827948894",
        "15355844173997133460193443827215813608",
        "5926191991225535611108493251472523452",
        "9021276647867432299905178786412085790",
        "783168957988038328215335671589521933",
        "16228603468139424182763927243444761380",
        "2269667668407047591467053395570672900",
        "5521267606006607139056322446837659066",
        "7698317183734210572767807069007527112",
        "5067617779464701501676144928895796029",
        "845367334399395781524625143345559411",
        "11296394378037710359608165348122234427",
        "6349338573078434336136847928266494041",
        "3916813835828462011996013321466862755",
        "10587191106531914671904397278325005239",
        "810006856428084109564087374352457598",
        "6274392765121331860680661432554609794",
        "15673133879386910990833257256550546973",
        "5068810054293429445404694858625251060",
        "9319684701530761669594814148870960041",
    ];
    let mds = vec![
        "4305573086397767967400691297297328992",
        "8709657853499394740099223236866819412",
        "15684428917634680806721098790372246290",
        "9121792160958932811910326887070413334",
        "11224260662709110394728308183766520086",
        "9281554088410427936740815715020890630",
        "16355293142558131717194885316207400619",
        "303334708406655638162514523501364049",
        "6868521097242021875716668010338777802",
        "11053777437338899972077765436323602622",
        "9139346387411190531298386267659615464",
        "3126252951703017727402558171984985997",
        "338028877451894153918354571679085166",
        "7870630440889685971128114364796747027",
        "7756895282287808596711552927173224366",
        "530334480113193068602926960063616848",
        "16863312788456695669689794044140528598",
        "1712417473922754761245623351384327128",
        "5659431867396538556970200150229239844",
        "12811187427986482940980601648061882599",
        "6088871876221355389947911367130710708",
        "4501664866324394255530834419310173089",
        "13739127194792335653007659352632433816",
        "3501241706283948515812256567133813022",
        "14367822290584989667596326900741095985",
    ];

    assert_eq!(ark.len(), (full_rounds + partial_rounds) * t);
    assert_eq!(mds.len(), t * t);

    let ark = convert_str_vec_to_fields::<F>(t, &ark)
        .map_err(|_| PoseidonConfigError::ConversionError)?;
    let mds = convert_str_vec_to_fields::<F>(t, &mds)
        .map_err(|_| PoseidonConfigError::ConversionError)?;

    Ok(PoseidonConfig {
        full_rounds,
        partial_rounds,
        alpha,
        ark,
        mds,
        rate,
        capacity,
    })
}

pub fn poseidon_parameters_bn124() -> PoseidonConfig<Fr> {
    poseidon_parameters::<Fr>().unwrap_or_else(|_| panic!("could not convert parameters"))
}

#[cfg(test)]
mod tests {
    use super::*;
    use crate::poseidon_parameters::tests::test_poseidon_against_vectors;
    use ark_bn124::Fr;
    use std::str::FromStr;

    #[test]
    fn test_poseidon() {
        let params = poseidon_parameters_bn124();

        let input0 = vec![Fr::from(0)];
        let digest0 = Fr::from_str("16991016607046266854414018657756091398").unwrap();

        let input1 = vec![Fr::from(1), Fr::from(2), Fr::from(42)];
        let digest1 = Fr::from_str("1282313456976737783187838002367720572").unwrap();

        let input2 = vec![
            Fr::from(2347272),
            Fr::from(3512325),
            Fr::from(950157783),
            Fr::from(35),
            Fr::from(26357),
            Fr::from(354738949),
            Fr::from(30086),
            Fr::from(246849),
            Fr::from(56943),
        ];
        let digest2 = Fr::from_str("567522318803572802795323053846415499").unwrap();

        let input3: Vec<_> = (0..100).into_iter().map(|i| Fr::from(i)).collect();
        let digest3 = Fr::from_str("11035604562366654525692517383685631911").unwrap();

        test_poseidon_against_vectors(
            &params,
            &vec![
                input0.as_slice(),
                input1.as_slice(),
                input2.as_slice(),
                input3.as_slice(),
            ],
            &vec![digest0, digest1, digest2, digest3],
        )
    }
}
